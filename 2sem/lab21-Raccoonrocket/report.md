# Отчет по лабораторной работе N 21 по курсу
# "Фундаментальная информатика"

Студент группы: M80-104Б, Борисов Сергей Павлович\
Контакты: 9802432172sergei@gmail.com\
Работа выполнена: 27.03.2022\
Преподаватель: Безлуцкая Елизавета Николаевна

## 1. Тема

Программирование на интерпретируемых языках

## 2. Цель работы

Составить программу выполнения заданных действий над файлом из интерпретируемых команд языка bash

## 3. Задание

Вариант 16\
Удаление файлов с указанным префиксом и с максимальными размерами, пока общий размер остающихся файлов не станет меньше заданного числа.\

Доп.условия: 3) Если указан параметр "?", то выводить подсказки; 4) Программа должна обеспечивать возможность установки режима трассировки.

## 4. Оборудование

Процессор: AMD Ryzen 3500U @ 2.1GHz\
ОП: 7851 Мб\
ТТН: 256 Гб\
Монитор: 1920x1080\

## 5. Программное обеспечение

Операционная система семейства: **linux (ubuntu)**, версия **18.10 cosmic**\
Интерпретатор команд: **bash**, версия **4.4.19**.\
Система программирования: **--**, версия **--**\
Редактор текстов: **emacs**, версия **25.2.2**\
Утилиты операционной системы: **--**\
Прикладные системы и программы: **--**\
Местонахождение и имена файлов программ и данных на домашнем компьютере: **--**\

## 6. Идея, метод, алгоритм решения задачи

Придумать/написать псевдокод, по которому стоит идти.\
В командной строке протестировать команды, на правильность их исполнения.\
Разобраться в написании скрипта на языке bash.\
Написать псевдо-скрипт.\
Собрать команды в скрипт и провеить правильность их исполнения.\
"Прикрутить" режим трассировки и возможность вывода подсказок.

## 7. Сценарий выполнения работы

1. dirs.sh - генерация тестовых данных
2. delete.sh - выполнение основного задания по варианту
3. Найти файлы с заданным префиксом
4. Сортировать их в порядке убывания по размеру
5. Удалять до тех пор, пока текущая директория не станет меньше заданного размера
6. "Прикрутить режим трассировки"
7. Проверить на правильность исполнения скрипта

## 8. Распечатка протокола

dirs.sh - генерация тестовых данных
```
RAND=$RANDOM
mkdir dir$RAND
cd dir$RAND
for (( j=0; j<30; j++ )) do
  RANDFILE=$RANDOM
  touch $RANDFILE.txt
  echo "$RANDOM$RANDOM$RANDOM$RANDOM" > RANDFILE.txt
  cd .
done
```

delete.sh - основное задание
```
#!/bin/bash
STATUS=0
if [ $1 ]; then
  PREFIX=$1
    if [ $PREFIX = ? ]; then
    echo "Script: Deleting files with specified prefix and with"
    echo "\t the maximum size while the total size of the remaining"
    echo "-------"
    echo "Instruction to use:\n"
    echo "Position: \"our_prefix\" \"your_ size\""
    echo "\n-t --- tracing mode --- place: beginning or end"
    echo "\nP.S. the prefix is case sensitive and size is Kb"
    exit
  fi
  if [ $PREFIX = -t ]; then
    STATUS=1
  fi
fi
if [ $STATUS -eq 1 ]; then
  PREFIX=$2
  SIZE=$3
else
  SIZE=$2
  if [ $3 ]; then
    MBTRACING=$3
    if [ $MBTRACING = -t ]; then
      STATUS=1
    fi
  fi
fi
if [ $STATUS -eq 0 ]; then
  LIST=`find . -type f -name "$PREFIX*" -exec ls -s {} \; | sort -nr | cut -d "/" -f 2`
  for file in $LIST; do
    CHECKER=`du | cut -b -3`
    if [ $CHECKER -gt $SIZE ]; then
      echo $file "was deleted"
      rm -rf $file
    else break
    fi
  done
  echo "Success"
  exit
fi
if [ $STATUS -eq 1 ]; then
  echo "You turn tracing mode  (@_@) \n"
  echo "And now you see all files with prefix "$PREFIX":\n-------"
  LIST=`find . -type f -name "$PREFIX*" -exec ls -s {} \; | sort -nr | cut -d "/" -f 2`
  echo $LIST
  echo "-------\nNow to started deleted the biggest files \n-------"
  for file in $LIST; do
    CHECKER=`du | cut -b -3`
    echo "Size current directory: " `du -h`
    echo "Size the biggest file: " `du -h $file`
    if [ $CHECKER -gt $SIZE ]; then
      echo $file "was deleted"
      rm -rf $file
    else
      echo "Our directory < $SIZE K"
      break
    fi
  done
  echo "That\`s all"
  exit
fi
```

## 9. Дневник отладки

```
+---+---------------+------------+-----------+---------------------------+-------------------------+-------------+
| № | Лаб. или дом. | Дата       | Время     | Событие                   | Действие по исправлению | Примечание  |
+===+===============+============+===========+===========================+=========================+=============+
|0  | Дом           | 21.03.2022 | 11:30     |Некорректно работает скрипт| Искать ошибку           | Мне грустно |
+-------------------+------------+-----------+---------------------------+-------------------------+-------------+
```

## 10. Замечания автора по существу работы

Работу считаю актуальной и полезной для ознакомления с устройством и написанием скриптов в bash.

## 11. Выводы

Данная лабораторная работа еще глубже познакомила с работой в терминале Linux, кроме этого научился писать скрипты и дополнительные условия к ним.

